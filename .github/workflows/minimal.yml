name: Minimal Workflow

on:
  workflow_dispatch:

permissions:
  contents: write

jobs:
  create-templates:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v3
      
      - name: Create directories
        run: mkdir -p Surge Loon
      
      - name: Create simple file
        run: echo "Test" > test.txt
      
      - name: List files
        run: |
          ls -la QuantumultX/
          echo "Listing successful"
          
      - name: Create template files with simple script
        run: |
          for file in QuantumultX/*.js; do
            filename=$(basename "$file" .js)
            echo "Processing $filename"
            
            # Create Loon file
            echo "#!name = ${filename}🔐APP解锁" > "Loon/${filename}.plugin"
            echo "#!desc = 媒体制作 - 插件" >> "Loon/${filename}.plugin"
            echo "#!author = 🅜ⓘ🅚ⓔ🅟ⓗ🅘ⓔ" >> "Loon/${filename}.plugin"
            echo "#!icon = https://raw.githubusercontent.com/Mikephie/icons/main/icon/${filename}.png" >> "Loon/${filename}.plugin"
            echo "" >> "Loon/${filename}.plugin"
            echo "[Script]" >> "Loon/${filename}.plugin"
            echo "http-response ^https?://example.com/ script-path=https://raw.githubusercontent.com/Mikephie/Script/main/qx/${filename}.js, requires-body=true, timeout=60, tag=${filename}" >> "Loon/${filename}.plugin"
            echo "" >> "Loon/${filename}.plugin"
            echo "[MITM]" >> "Loon/${filename}.plugin"
            echo "hostname = example.com" >> "Loon/${filename}.plugin"
            
            # Create Surge file
            echo "#!name = ${filename}🔐APP" > "Surge/${filename}.sgmodule"
            echo "#!desc = 媒体制作 - 模块" >> "Surge/${filename}.sgmodule"
            echo "#!author = 🅜ⓘ🅚ⓔ🅟ⓗ🅘ⓔ" >> "Surge/${filename}.sgmodule"
            echo "#!category=🔐APP" >> "Surge/${filename}.sgmodule"
            echo "" >> "Surge/${filename}.sgmodule"
            echo "[Script]" >> "Surge/${filename}.sgmodule"
            echo "${filename} = type=http-response, pattern=^https?://example.com/, script-path=https://raw.githubusercontent.com/Mikephie/Script/main/qx/${filename}.js, requires-body=true, max-size=-1, timeout=60" >> "Surge/${filename}.sgmodule"
            echo "" >> "Surge/${filename}.sgmodule"
            echo "[MITM]" >> "Surge/${filename}.sgmodule"
            echo "hostname = %APPEND% example.com" >> "Surge/${filename}.sgmodule"
          done
          
          echo "Files created successfully"
      
      - name: Commit and push changes
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          git add Surge/ Loon/ test.txt
          git commit -m "Add template files" || echo "No changes to commit"
          git push || echo "Nothing to push"
